<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate — calc • raster</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate — calc"><meta property="og:description" content="Calculate values for a new Raster* object from another Raster* object, using a formula.

If x is a RasterLayer, fun is typically a function that can take a single vector as input, and return a vector of values of the same length (e.g. sqrt). If x is a RasterStack or RasterBrick, fun should operate on a vector of values (one vector for each cell). calc returns a RasterLayer if fun returns a single value (e.g. sum) and it returns a RasterBrick if fun returns more than one number, e.g., fun=quantile.
In many cases, what can be achieved with calc, can also be accomplished with a more intuitive 'raster-algebra' notation (see Arith-methods). For example, r &amp;lt;- r * 2 instead of

r &amp;lt;- calc(r, fun=function(x){x * 2}, or r &amp;lt;- sum(s) instead of

r &amp;lt;- calc(s, fun=sum). However, calc should be faster when using complex formulas on large datasets. With calc it is possible to set an output filename and file type preferences.
See (overlay) to use functions that refer to specific layers, like (function(a,b,c){a + sqrt(b) / c})"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">raster</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.6-27</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rspatial/raster/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate</h1>

    <div class="hidden name"><code>calc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate values for a new Raster* object from another Raster* object, using a formula.</p>

<p>If <code>x</code> is a RasterLayer, <code>fun</code> is typically a function that can take a single vector as input, and return a vector of values of the same length (e.g. <code>sqrt</code>). If <code>x</code> is a RasterStack or RasterBrick, fun should operate on a vector of values (one vector for each cell). <code>calc</code> returns a RasterLayer if <code>fun</code> returns a single value (e.g. <code>sum</code>) and it returns a RasterBrick if <code>fun</code> returns more than one number, e.g., <code>fun=quantile</code>.</p>
<p>In many cases, what can be achieved with <code>calc</code>, can also be accomplished with a more intuitive 'raster-algebra' notation (see <code><a href="Arith-methods.html">Arith-methods</a></code>). For example, <code>r &lt;- r * 2</code> instead of</p>

<p><code>r &lt;- calc(r, fun=function(x){x * 2}</code>, or <code>r &lt;- sum(s)</code> instead of</p>

<p><code>r &lt;- calc(s, fun=sum)</code>. However, <code>calc</code> should be faster when using complex formulas on large datasets. With <code>calc</code> it is possible to set an output filename and file type preferences.</p>
<p>See (<code><a href="overlay.html">overlay</a></code>) to use functions that refer to specific layers, like (<code>function(a,b,c){a + sqrt(b) / c}</code>)</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'Raster,function'</span></span>
<span><span class="fu">calc</span><span class="op">(</span><span class="va">x</span>, <span class="va">fun</span>, filename<span class="op">=</span><span class="st">''</span>, <span class="va">na.rm</span>, forcefun<span class="op">=</span><span class="cn">FALSE</span>, forceapply<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Raster* object</p></dd>

  <dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>function</p></dd>

  <dt id="arg-filename">filename<a class="anchor" aria-label="anchor" href="#arg-filename"></a></dt>
<dd><p>character. Output filename (optional)</p></dd>

  <dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Remove <code>NA</code> values, if supported by 'fun' (only relevant when summarizing a multilayer Raster object into a RasterLayer)</p></dd>

  <dt id="arg-forcefun">forcefun<a class="anchor" aria-label="anchor" href="#arg-forcefun"></a></dt>
<dd><p>logical. Force <code>calc</code> to not use fun with apply; for use with ambiguous functions and for debugging (see Details)</p></dd>

  <dt id="arg-forceapply">forceapply<a class="anchor" aria-label="anchor" href="#arg-forceapply"></a></dt>
<dd><p>logical. Force <code>calc</code> to use fun with apply; for use with ambiguous functions and for debugging (see Details)</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments as for <code><a href="writeRaster.html">writeRaster</a></code></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>a Raster* object</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The intent of some functions can be ambiguous. Consider:</p>
<p><code><a href="https://rspatial.org/raster" class="external-link">library(raster)</a></code></p>
<p><code>r &lt;- raster(volcano)</code></p>
<p><code>calc(r, function(x) x * 1:10)</code></p>
<p>In this case, the cell values are multiplied in a vectorized manner and a single layer is returned where the first cell has been multiplied with one, the second cell with two, the 11th cell with one again, and so on. But perhaps the intent was to create 10 new layers (<code>x*1, x*2, ...</code>)? This can be achieved by using argument <code>forceapply=TRUE</code></p>

<p><code>calc(r, function(x) x * 1:10, forceapply=TRUE)</code></p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>For large objects <code>calc</code> will compute values chunk by chunk. This means that for the result of <code>fun</code> to be  correct it should not depend on having access to _all_ values at once. For example, to scale the values of a Raster* object by subtracting its mean value (for each layer), you would _not_ do, for Raster object <code>x</code>:</p>
<p><code>calc(x, function(x)scale(x, scale=FALSE))</code></p>
<p>Because the mean value of each chunk will likely be different. Rather do something like</p>
<p><code>m &lt;- cellStats(x, 'mean')</code></p>
<p><code>x - m</code></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code> <a href="overlay.html">overlay</a></code> ,  <code> <a href="reclassify.html">reclassify</a></code>,  <a href="Arith-methods.html">Arith-methods</a>, <a href="Math-methods.html">Math-methods</a></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Robert J. Hijmans and Matteo Mattiuzzi</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="raster.html">raster</a></span><span class="op">(</span>ncols<span class="op">=</span><span class="fl">36</span>, nrows<span class="op">=</span><span class="fl">18</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="getValues.html">values</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="ncell.html">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># multiply values with 10</span></span></span>
<span class="r-in"><span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">rc1</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">r</span>, <span class="va">fun</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set values below 100 to NA. </span></span></span>
<span class="r-in"><span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">&lt;</span><span class="fl">100</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">rc2</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">r</span>, <span class="va">fun</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set NA values to -9999</span></span></span>
<span class="r-in"><span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">9999</span>; <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span> </span></span>
<span class="r-in"><span><span class="va">rc3</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">rc2</span>, <span class="va">fun</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using a RasterStack as input</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="stack.html">stack</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">r</span><span class="op">*</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># return a RasterLayer</span></span></span>
<span class="r-in"><span><span class="va">rs1</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">s</span>, <span class="va">sum</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># return a RasterBrick</span></span></span>
<span class="r-in"><span><span class="va">rs2</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">s</span>, fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span> <span class="op">*</span> <span class="fl">10</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># recycling by layer</span></span></span>
<span class="r-in"><span><span class="va">rs3</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">s</span>, fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use overlay when you want to refer to individual layer in the function</span></span></span>
<span class="r-in"><span><span class="co"># but it can be done with calc: </span></span></span>
<span class="r-in"><span><span class="va">rs4</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">s</span>, fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## </span></span></span>
<span class="r-in"><span><span class="co"># Some regression examples</span></span></span>
<span class="r-in"><span><span class="co">## </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create data</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="raster.html">raster</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">10</span>, ncol<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="setValues.html">setValues</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="ncell.html">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="va">i</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="setValues.html">setValues</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="ncell.html">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="va">i</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="stack.html">stack</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="stack.html">stack</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># regression of values in one brick (or stack) with another</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="stack.html">stack</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># s1 and s2 have 12 layers; coefficients[2] is the slope</span></span></span>
<span class="r-in"><span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span> <span class="op">~</span> <span class="va">x</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">24</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">s</span>, <span class="va">fun</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># regression of values in one brick (or stack) with 'time'</span></span></span>
<span class="r-in"><span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="nlayers.html">nlayers</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">time</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">s</span>, <span class="va">fun</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get multiple layers, e.g. the slope _and_ intercept</span></span></span>
<span class="r-in"><span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">time</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">s</span>, <span class="va">fun</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### A much (&gt; 100 times) faster approach is to directly use </span></span></span>
<span class="r-in"><span><span class="co">### linear algebra and pre-compute some constants</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## add 1 for a model with an intercept</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">time</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## pre-computing constant part of least squares</span></span></span>
<span class="r-in"><span><span class="va">invXtX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="transpose.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="transpose.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## much reduced regression model; [2] is to get the slope</span></span></span>
<span class="r-in"><span><span class="va">quickfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">(</span><span class="va">invXtX</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">s</span>, <span class="va">quickfun</span><span class="op">)</span> </span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

